一、安全策略配置 ——
1. 配置SELinux
2. 配置SSH访问（+防火墙）【##】
3. 自定义用户环境（别名设置）
4.  配置防火墙端口转发
﻿
二、网络连接配置 ——
5. 配置链路聚合
6. 配置IPv6地址


三、配置网站服务器 ——
12.实现一个web服务器
13.配置安全web服务
14.配置虚拟主机
15.配置web内容的访问
16.实现动态WEB内容


四、配置文件服务器/客户端 —— 
8. 通过Samba发布共享目录
9. 配置多用户Samba挂载
10. 配置NFS共享服务 【##】
11. 挂载NFS共享 【##】
19. 配置iSCSI服务端 
20. 配置iSCSI客户端





五、Shell脚本编程 —— 
17. 创建一个脚本
18. 创建一个添加用户的脚本



六、配置及管理数据库 ——
21. 配置一个数据库
22. 数据库查询（填空）


七、配置邮件服务器 ——







RHCE 核心考点列表
####################################################

一、安全策略配置 ——
1. 配置SELinux
2. 配置SSH访问（+防火墙）【##】
3. 自定义用户环境（别名设置）
4.  配置防火墙端口转发

在system1上：
1）修改默认安全区，允许任何访问
2）拒绝指定的某个网段访问
3）实现端口转发（5423 =》80）
# firewall-cmd  --permanent  --zone=trusted
--add-forward-port=被转发端口设置:协议设置:目标端口设置
# firewall-cmd  --permanent  --zone=trusted
--add-forward-port=port=被转发端口:proto=tcp:toport=目标端口
# firewall-cmd  --permanent  --zone=trusted
--add-forward-port=port=5423:proto=tcp:toport=80

在system2上：
1）修改默认安全区，允许任何访问
2）拒绝指定的某个网段访问

测试端口转发时，需要从其他机器访问
http://server0.example.com:5423
http://server0.example.com



二、网络连接配置 ——
5. 配置链路聚合
如何创建聚合连接（运行模式）

# man  nmcli-examples  ==》 /Team1 获得命令操作帮助

# man  teamd.conf ==》/"runner 获得运行模式配置

6. 配置IPv6地址
# nmcli  con  mod  "连接名"  ipv6.method  manual  ipv6.addresses  "IPv6地址/掩码位数"  
测试工具：
# ping6  IPv6地址

三、配置网站服务器 ——
12.实现一个web服务器
13.配置安全web服务
14.配置虚拟主机
15.配置web内容的访问
16.实现动态WEB内容


四、配置文件服务器/客户端 —— 
8. 通过Samba发布共享目录
软件包：samba
配置：/etc/samba/smb.conf
系统服务：smb


9. 配置多用户Samba挂载
软件包：samba-client、cifs-utils
配置：/etc/fstab



10. 配置NFS共享服务 【##】
11. 挂载NFS共享 【##】

简单NFS共享服务端的配置 ——
软件包：nfs-utils
配置文件：/etc/exports
文件夹的绝对路径    客户机地址(ro)
系统服务：nfs-server

简单NFS共享客户端的使用 ——
# vim  /etc/fstab
服务器地址:NFS共享目录的绝对路径  挂载点  nfs _netdev  0  0
# mount  -a


提前准备LDAP+kerberos认证环境：
LDAP服务器提供用户名（比如 ldapuser0、krishna）
kerberos服务器提供密码验证（比如密码 kerberos）

在两台虚拟机上执行以下操作（正式考试不需要）
# lab  nfskrb5  setup


安全NFS共享服务端的配置 ——
软件包：nfs-utils
1）配置文件：/etc/exports
文件夹的绝对路径    客户机地址(rw,sec=krb5p)
2）为服务器本机部署kerberos加密密钥到 /etc/krb5.keytab
3）系统服务：nfs-server、nfs-secure-server

安全NFS共享客户端的使用 ——
1）为客户机本机部署kerberos加密密钥到 /etc/krb5.keytab
2）# vim  /etc/fstab
服务器地址：NFS共享目录的绝对路径  挂载点  nfs sec=krb5p,_netdev  0  0
3）系统服务：nfs-secure
4）挂载安全NFS共享
# mount  -a

验证方法：
# ssh  ldapuser0@desktop0
$ touch  /mnt/nfssecure/project/a.txt


常见的一些问题：
1）No route to host ==》对方的防火墙拒绝
2）RPC: Program not registered ==》对方的NFS服务没开
3）mount -a时 incorrect option ==》客户端nfs-secure没开
4）mount  -a时没响应 ==》NFS服务端联系不上（重起）
5）mount  -a时提示 access  denied ==》权限不够
	a. 服务端的 exports 授权的地址有误
	b. 服务端或客户端密钥有问题（文件名或内容有错误）
	c. 密钥文件过期（classroom太久没重置）
	d. 忘记执行lab。。。操作
	e. 服务端的 nfs-secure-server 服务没开

检查密钥文件是否符合：
# klist  -k  /etc/krb5.keytab
# less  /var/log/messages


19. 配置iSCSI服务端 
用途：通过网络提供网络磁盘（target === 磁盘柜（包含多块逻辑磁盘））
软件包：targetcli
配置工具：targetcli
系统服务：target

提供的target的IQN名称？（题目提供）

20. 配置iSCSI客户端
用途：通过网络访问网络磁盘（发现、连接）
软件包：iscsi-initiator-utils
配置工具：iscsiadm
系统服务：iscsi、iscsid（修改IQN名之后重启一次）

客户机的IQN名称？（自己拟定，可以参考iSCSI磁盘名做一些改变）

iSCSI客户端在RHEL7.0环境下有个小bug，
导致的问题 reboot 时会死机
解决办法：
改用 sync;reboot  -f 代替 reboot
# vim  /etc/bashrc
alias  reboot='sync;reboot  -f'
# sync;reboot


五、Shell脚本编程 —— 
17. 创建一个脚本
if多分支语句：
if [ 条件判断 ]；then
	命令
elif [ 条件判断 ]；then
	命令
else
	命令
fi

18. 创建一个添加用户的脚本
if [ 条件判断 ]；then
	命令
fi

for 循环：
for i in 参数1 参数2
 do
      命令
done 



六、配置及管理数据库 ——
21. 配置一个数据库
22. 数据库查询（填空）

忘记数据库的root密码，重建数据库的操作：
# rm  -rf  /var/lib/mysql
# yum  -y  reinstall  mariadb-server
# systemctl  restart  mariadb




七、配置邮件服务器 ——
7. 配置本地邮件服务 【##】
标准邮件服务器（qq邮箱）：
    1）提供电子邮箱（yangguo@qq.com）及存储空间
    2）为客户端向外发送邮件给其他邮箱（xiaolongnv@163.com）
    3）接收/投递其他邮箱用户发给本邮箱用户的邮件
零客户邮件服务器（机房内网）： —— nullclient 只发不收
    1）不提供电子邮箱
    2）为客户端向外发送邮件给其他邮箱（xiaolongnv@163.com）
    3）不接收/投递其他邮箱用户发给本服务器的邮件

    属性配置：有一台后端标准邮件服务器、发件来源

    例如：旅游景点（海南三亚）代寄礼品（10个椰子）的代办点

考试环境：
1）把 system1、system2 配置为一台零客户邮件服务器
2）由考官提供后端的标准邮件服务器


!!!! 关键点：两台虚拟机都需要正确配置静态的主机名

练习环境：
1）把 server0 配置成零客户邮件服务器
# vim  /etc/postfix/main.cf
relayhost = [后端邮件服务器地址]
inet_interfaces = loopback-only
myorigin = 发件来源地址
mynetworks = 127.0.0.0/8  [::1]/128
mydestination = 哪些邮箱区域/后缀需要安排投递邮件
local_transport = error:报错信息

2）使用 desktop0 来模拟后端的标准邮件服务器
# lab  smtp-nullclient  setup

测试目标 —— 在server0上发一封邮件给本机的student用户，结果会在deskop0上的student用户看到这封邮件



###################################################
RHCE部分 ——
答题顺序：
1）看考试说明（提供地址、用户、软件资源、注意事项、用户密码、网段地址）
2）整体浏览所有考试题
3）两台虚拟机的root密码是预先告知的，不需要重设
4）两台虚拟机的主机名需要手动配置正确
5）两台虚拟机的IP地址参数是通过DHCP分配的，可以不用改
6）先做高风险题（防火墙、Samba、安全NFS、iSCSI）
7）再答其他题目

交卷处理：
1）先把虚拟机2、虚拟机1关机
2）再重新开启虚拟机1，等60秒左右再开虚拟机2
3）检查所有答题结果
4）告知考官交卷

整体注意事项 ——
1）防火墙的处理
    考试时需要开启（system1端口转发、system1/system2网段访问控制）
2）SELinux的处理
    考试时要求enforcing，会影响Samba、Web服务
    解决SELinux对Samba的影响：
    # setsebool  -P  samba_export_all_rw=on
    解决SELinux对Web的影响：
	网页目录尽量放到 /var/www/ 下的子目录
	# semanage  port  -a  -t  http_port_t  -p tcp  8909
3）yum软件源
    由考官服务器提供，需要手动指定使用这个源（没有对应考题）


其他注意事项：
1）SSH访问控制
如果防火墙能搞定此题，那么sshd服务可跳过
2）别名设置
需要在 /etc/bashrc 去设置，
alias   别名='实际执行的命令行'
3）防火墙部分
配置工具：firewall-config或firewall-cmd
在system1上：
    默认安全区设为trusted，
    将指定网段地址添加到block安全区
    实现端口转发（5423 =》80），测试时不要从本机访问
在system2上：
    默认安全区设为trusted，
    将指定网段地址添加到block安全区
4）配置链路聚合
网卡 eth1、eth2 考试时是现成的
添加链路聚合的操作 可以 man  nmcli-examples ==> Team1
链路聚合的runner配置 可以 man  teamd.conf ==> "runner
尽量复制粘贴不要手写
为聚合连接配置的IP地址千万不要与eth0在同一个网段
5）配置IPv6地址
记得为虚拟机设置静态主机名
测试操作  ping6  IPv6地址，不要误写 ping6  IPv6地址/64
6）零客户邮件服务器
考试时 system1、system2都要配置为零客户邮件服务器
关于 local_transport = error:报错信息  配置，
考试时没要求的话不要写（只是模拟考试需要）
7）配置及访问Samba共享
ls 如果能看到结果 说明 有读取权限
mkdir  mulu1 如果能成功 说明有写入权限

客户端挂载参数：
username=用户名,password=密码,multiuser,sec=ntlmssp,_netdev

多用户访问测试，不能用root直接测：
# su  -  普通用户
$ cifscreds  add  -u  共享用户名  服务器地址
Password:共享用户的密码
$ 访问挂载点

所有涉及到开机自动挂载的操作，
建议先编写/etc/fstab文件，再执行 mount  -a来检查

8）配置及访问NFS共享
system1需要开启的系统服务：
	nfs-server.service
	nfs-secure-server.service
system2需要开启的系统服务：
	nfs-secure.service

实现安全NFS的环境：
考试时由考官预先布置好
模拟考试时需要在两台虚拟机手动执行 lab  nfskrb5  setup

!!! 所有的lab、rht-vmctl操作在正式考试时都不可用


发布安全NFS共享：
# vim  /etc/exports
目录绝对路径		客户网段地址/掩码位数(rw,sec=krb5p)

客户端挂载参数：
_netdev ==》普通NFS
sec=krb5p,_netdev ==》普通NFS

有可能出现NFSv4版本要求——
在system1服务端：
# vim  /etc/sysconfig/nfs
RPCNFSDARGS="-V  4" 			【注意是大写字母  -V】

在system2客户端：
挂载参数添加 v4 				【注意是小写字母 v】

9）iSCSI网络磁盘
客户端挂载参数：
_netdev

客户端重起会卡死的问题：
# vim  /etc/bashrc
.. ..
alias  reboot='sync ; reboot -f'
# source  /etc/bashrc

客户机别忘了设置IQN名称——
根据题目给的iSCSI磁盘名修改（最后一个部分）
在配置文件 /etc/iscsi/initiatorname.iscsi 中指定，配完以后记得要重起 iscsid 服务
这个IQN名称 必须 与 iSCSI服务端的 acls 授权设置一致

客户端在对连接的iSCSI磁盘分区/格式化操作时，千万看仔细不要格式化错了

10）关于客户机上 Samba/NFS/iSCSI 资源的挂载问题
现象：客户机重起以后部分资源没有挂载成功，需要手动执行 mount  -a才能挂上
原因：服务器准备这些资源需要一段时间，在客户机开机时还没准备完毕，导致挂载不成功
解决办法：
# chmod  +x  /etc/rc.d/rc.local
# vim  /etc/rc.d/rc.local
.. ..
for  i  in  {1..30}
do
    mount  -a
	sleep  5
done
11）Web服务器
建议为每一个虚拟站点准备独立的配置文件，
默认站点的配置文件名最好以00开台
httpd  -t 检查语法

动态网站这个，别忘了 Listen 8909
测试访问动态网站时 http://域名:8909/  要写对
12）Shell脚本
脚本的文件名和路径不要写错
foo.sh 不要写成foo
batchusers 不要写成 batchusers.sh
13）数据库
数据库名、用户名不要写错（区分大小写）
删除空密码的root用户时，千万要提前为root用户设好密码
必要时重建数据库系统 ——
# systemctl  stop  mariadb
# rm  -rf  /var/lib/mysql/
# yum  -y  reinstall  mariadb-server
# systemctl  restart  mariadb 