
曾 晔

RHCE考前辅导群：
QQ-GROUP-303486093

RHCE毕业群：

DAY01～DAY02 RHCSA考点解析
DAY03～DAY06 RHCE考点解析
DAY07 考前串讲
DAY08 指导练习+自我评测

09：30～12：00
13：30～17：30 （其中16：00～17：30自由练习）


随堂笔记/资料：http://172.40.50.113/rhce/
练习题：http://127.0.0.1/exam/
访问讲师机桌面：vncviewer  172.40.50.113:7000


﻿
RHCSA 核心考点列表
####################################################

一、开考准备 —— 
1. 重设虚拟机的root密码
1）开机时按两次e键，找到linux16行修改启动参数，添加 rd.break console=tty0 参数
2）按Ctrl + x键启动，获得一个具有root权限的临时环境
3）默认将正常系统目录只读挂载到 /sysroot， =》重新rw挂载
4）切换到/sysroot根环境【chroot】
5）执行修复操作（重置root密码）
—— 如果SELinux已经启用，通知SELinux重新标记安全标签
6）退出/sysroot环境，重启系统


!!!! 关于SELinux安全保护机制

2. 为虚拟机配置网络

主机名、IP地址参数

对应的系统服务：network ==> NetworkManager
主机名配置 （/etc/hostname）：
hostnamectl  
hostnamectl  set-hostname  主机名

RHEL7系统中系统服务的管理：
systemctl  start|stop|restart|status  服务名
systemctl  enable|disable  服务名


网络设备：内核识别的网卡接口
网络连接：管理员为指定的网卡提供的配置


IP地址参数配置：
—— 查看连接
# nmcli  device status
# nmcli  connection show
# nmcli  connection show  "连接名"

—— 修改连接配置
RHEL7.0系统：
# nmcli  connection modify "连接名" ipv4.method  manual|auto  ipv4.addresses "IP地址/掩码位数  默认网关" ipv4.dns  DNS服务器地址  ipv4.dns-search "搜索域后缀"

RHEL7.2及以后系统：
# nmcli  connection modify "连接名" ipv4.method  manual|auto  ipv4.addresses "IP地址/掩码位数"  ipv4.gateway    默认网关地址   ipv4.dns  DNS服务器地址  ipv4.dns-search "搜索域后缀" 

# nmcli  connection  modify "System eth0" connection.autoconnect  yes


—— 激活/停用连接
# nmcli  connection up  "连接名"
# nmcli  connection down  "连接名"


—— 添加/删除连接配置
# nmcli  connection add  con-name  "连接名"  ifname "接口名"  type  ethernet
# nmcli  connection delete  "连接名" 

RHEL7系统中的Tab键补齐（命令名、文件路径、服务名、软件包、选项、子命令）


二、系统管理任务 ——
1. 添加YUM源
软件源：集中提供.rpm软件安装包的服务器
客户机：通过yum命令工具来使用软件源提供的软件包

yum客户端命令的配置文件位置：
/etc/yum.conf
/etc/yum.repos.d/*.repo
[软件源ID]
gpgcheck = 0 			//是否要求检查软件包签名
enabled = 1
baseurl = 软件源的网址
name = 软件源的说明

使用yum管理软件包：
yum  list
yum  list  软件名...
yum  info  软件名...
yum  search  HTTP
yum  -y  install  软件名...
yum  -y  remove  软件名...
yum  -y  reinstall  软件名...
yum  provides  文件路径

3. 添加用户/组账号
11. 配置用户账号
用户账号 —— 登录，运行身份，访问文件、文件所有权
组账号 —— 包含一批用户，方便分配权限

用户属性：登录名、密码、家目录、登录Shell、UID、GID（基本组）
组属性：组名、GID、组成员

用户账号的增删改查：
useradd  登录名
useradd  -u  UID  -g  GID  -G  附属组名   -d  家目录  -s  登录Shell  登录名
passwd  用户名
echo  密码  |  passwd  --stdin  用户名
userdel  -r  用户名
usermod   -u  UID  -g  GID  -G  附属组名   -d  家目录  -s  登录Shell  -l  登录名  用户名
id  用户名

组账号的增删改查：
groupadd  -g  GID  组名
groupdel  组名
groupmod  -g  GID  -n  新的组名  组
gpasswd  -a  用户名  组名
gpasswd  -d  用户名  组名
usermod  -a  -G  组名  用户名

4. 设置文件权限
文档的所有权 —— 归属
属主：拥有此文档的用户（User）
属组：拥有此文档的组（Group）
其他用户（Other）

设置文档的归属权：
chown -R  用户名   文档...
chown -R  :组名   文档...
chown -R  用户名:组名   文档...


文档的访问方式 ——  基本权限
读取（Read），看文件内容、看目录内容
写入（Write），修改文件内容、修改目录内容
可执行（eXcute），运行程序文件、进入目录

chmod  -R  ugo+-=rwx  文档...

查看文件的归属和权限属性信息：
ls  -l  文档...
ls  -ld  文档...

针对文档的归属权区分类别太笼统，提出ACL访问控制机制
—— 可以为单个用户或组设置独立的权限
getfacl  文档...
setfacl  -m user:用户名:权限  文档...
setfacl  -m group:组名:权限  文档...


6. 建共用目录（SGID）
附加权限：
针对基本权限的类别只有r、w、x这三种，提出的另外的集中权限
附加在u、g、o的x位上

附加在属主（u）的x位，字符标记s —— Set UID
   主要适用于可执行文件，把属主的权限传递给使用这个程序的用户
   比如passwd命令
   操作：chmod  u+s  可执行文件

附加在属组（g）的x位，字符标记s —— Set GID
   主要适用于目录，把属组的身份传递给目录下新建的子目录或文件
   操作：chmod  g+s  目录

附加在其他人（o）的x位，字符标记t —— Sticky Bit
   主要适用于公共目录，限制用户的写入权限不能滥用（只能操作自己的文档）
   比如/tmp目录
   操作：chmod  o+t  公共目录

5. 配置计划任务
用途：在计划的时间点（周期性）反复执行的一些任务
系统服务：crond
配置计划任务：
# crontab  -e  [-u  用户名]  【-l、-r】
分  时  日  月 周  任务操作命令


时间点的表示：
*
1-5
1，3，5
*/5

比如：
1）每3天执行一次数据库备份
5  0  */3  *  *  数据库备份操作
2）每5分钟采集一次监控数据
*/5	*  *  *  *  采集操作
3）任务记录"5  0  1-15  *  5  任务命令行"在何时执行？（或者）



配置关键 —— 指定时间、指定任务操作
参考/etc/crontab


7. 升级内核
零散的rpm软件包如何安装：
rpm  -ivh  软件包文件.rpm
rpm  -ivh  软件包文件的下载地址

先根据给的网址找到软件安装文件 kernel-版本号..rpm 的下载地址
然后下载对应的安装文件
再执行rpm去安装

Linux系统内核文件：/boot/vmlinuz-*



三、文档管理 ——
13. 查找文件（find）
用法：find  [目录]  [查找条件]

常用的查找条件：
-name  "文件名"
-type  类型（f、d、l、b、c）
-size  大小（+4M、-10M）
-mtime  最近修改的天数（+30、-3）
-user  属主
-group  属组

多个查找条件的组合：
条件1  -a 条件2
条件1  -o 条件2

处理find找到的每一个结果文件：
-exec  处理操作命令{}  \;


关于/proc提示，忽略即可：
find: ‘/proc/3343/task/3343/fdinfo/6’: 没有那个文件或目录
find: ‘/proc/3343/fdinfo/6’: 没有那个文件或目录


14. 检索文本（grep）
用法：
grep  [-选项] '匹配模式'  文件...
命令行  |  grep  [-选项]  '匹配模式'  

常见选项：
-v，将条件取反
-i，忽略大小写
-c，统计匹配结果的行数
-n，输出结果的同时显示对应的行数
-o，只输出匹配结果（而不是真行）

匹配模式：
关键词
正则表达式（比如 ^word、word$、^$）


16. 创建归档（tar）
常见的归档文件格式：
.tar.gz、.tar.bz2、.tar.xz

归档：tar，多个文件合并为一个文件
压缩：gzip/bzip2/xz，大文件变成小文件

制作归档压缩包 —— 备份：
tar  -zcPf 备份文件.tar.gz  被备份的文档...
tar  -jcPf 备份文件.tar.bz2  被备份的文档...
tar  -JcPf 备份文件.tar.xz  被备份的文档...

查看归档压缩包的内容清单：
tar  -tPf  备份文件.tar.* 

释放归档压缩包 —— 恢复：
tar  -xf  备份文件.tar.* 
tar  -xPf  备份文件.tar.* 
tar  -xf  备份文件.tar.*  -C  目标文件夹



四、配置应用客户端 ——
10. 设置NTP时间同步客户端
NTP，网络时间协议，通过服务器为客户机提供标准时间

软件包：chrony
配置文件：/etc/chrony.conf
server  NTP服务器的地址

系统服务：chronyd

测试方法：
date
date  -s  'yyyy-mm-dd  HH:MM:SS'
timedatectl
timedatectl  set-ntp yes


8. 设置LDAP客户端
LDAP，轻量级目录访问协议
用途：通过一台集中的服务器为客户机提供一些信息、资源（用户名、密码、主机地址、通讯录、……）

用户账号集中认证：
LDAP服务器提供用户名、密码
LDAP客户机使用由LDAP服务器提供的用户名/密码

配置关键：
LDAP服务器需要提前配置好
客户机得知道LDAP服务器的地址
客户机得经过LDAP服务器的授权（Base DN）
通信过程需要加密（使用由服务器提供的证书文件）

软件包：sssd
系统服务：sssd
配置工具：
authconfig-tui 
或 authconfig-gtk（需要额外安装）

必要时需要手动部署证书到 /etc/openldap/cacerts/


9. 设置autofs触发挂载+NFS共享客户端
目标：
将classroom上的NFS共享的/home/guests/ldapuser0
在server0这个机器上出现 /home/guests/ldapuser0


手动连接NFS共享目录：
mount  服务器地址:共享目录绝对路径   本机的挂载点

实现文件系统的自动/按需挂载 ——
autofs的作用：
1）当需要访问 ldapuser0 的家目录时，能够自动创建对应的挂载点目录，并且自动挂载对应NFS共享资源
2）当不再需要访问 ldapuser0 的家目录时，能够自动卸载挂载到家目录的文件系统，并且删除挂载点

软件包、系统服务：autofs
配置autofs：
准备工作，提前为挂载点创建对应的父目录
1）修改 /etc/auto.master
挂载点父目录的路径 		挂载策略文件的路径
/home/guests 	/etc/guests.rule
2）通过具体的策略文件来指定“当访问哪个目录时挂载哪个设备”
挂载点目录名	-挂载参数 		服务器地址:NFS共享资源路径
ldapuser0	-rw,v3		classroom.example.com:/home/guests/ldapuser0

补充说明：
1）如果题目未涉及NFS版本，那么 ,v3 不需要写
2）如果题目要求所有的LDAP用户都可用，可调整策略如下
*  -rw,v3  classroom.example.com:/home/guests/&



五、磁盘分区及存储 ——

考试环境：
只有一块磁盘 /dev/vda，使用情况如下：
/dev/vda1 ==》/boot 
/dev/vda2 ==》卷组（包含 /、/home、……）
剩余少部分空间

自己准备练习环境：
有一块磁盘 /dev/vda，没有剩余空间
额外提供一块磁盘 /dev/vdb，全部为可用空间
===》把/dev/vdb模拟成考试时/dev/vda的环境
# fdisk  /dev/vdb
n 回车、回车、回车、+200M
n 回车、回车、回车、+2000M
n 回车、回车、回车、+1000M
p
w
# partprobe  /dev/vdb



Linux系统使用磁盘设备的过程：
内核识别 -> 分区规划 -> 格式化 -> 挂载 -> 读写数据

分区相关工具：fdisk、gdisk、parted、partprobe
格式化相关工具：mkfs.ext4、mkfs.xfs、mkfs.vfat、mkswap
挂载/卸载操作：mount、umount、/etc/fstab、autofs
读写数据操作：ls、vim、mkdir、cp、……


磁盘分区模式：
msdos模式 —— 最多4个主分区，1个扩展分区（更多逻辑分区）
gpt模式 —— 最多 128个主分区，支持>2.2TB磁盘


fdisk支持msdos模式 	==》分区更改需要 w 保存才生效
gdisk支持gpt模式	==》分区更改需要 w 保存才生效
parted支持msdos、gpt模式  ==》更改立即生效

分区操作：
fdisk  /dev/vdb


考试的时候，在执行分区操作前，需要先明确2个问题：
1）需要新建几个分区 【3】
2）新建每个分区的大小分别是多少 【> 300M、> 800M、512M】
在不影响 /dev/vdb 磁盘原有分区表情况下，新建3个分区

补充说明：fdisk  -l  /dev/vdb 检查分区模式
====!!!! 如果是 dos模式
# fdisk  /dev/vdb
n 选择 e 扩展分区，起始位置、结束位置都默认
n 回车、+500M 
n 回车、+1000M
n 回车、+512M
p
w
# partprobe  /dev/vdb
# reboot

====!!!! 如果是 gpt模式
# gdisk  /dev/vdb
n 分区编号、+500M、回车 
n 分区编号、+1000M、回车 
n 分区编号、+512M、回车 
p
w
# partprobe  /dev/vdb
# reboot


15. 添加逻辑卷

2. 扩展逻辑卷
考试环境：
预先提供并且已经格式化过的逻辑卷 vo，不需要自己创建

练习环境：
需要自行准备并且格式化逻辑卷 vo
1）建卷组 vgcreate  卷组名  小磁盘的路径 ...
# vgcreate  systemvg  /dev/vdb1
2）建逻辑卷 lvcreate  -L 容量大小  -n  逻辑卷名称  卷组名
# lvcreate  -L 180M  -n  vo  systemvg
3）格式化及挂载
# mkfs.ext3  /dev/systemvg/vo
# mkdir  /vo
# mount  /dev/systemvg/vo  /vo

LVM存储方案的优势：
1）化零为整，把许多小磁盘/分区整合成更大的虚拟磁盘（VG卷组）
2）动态伸缩，从卷组内根据需要划分虚拟分区（LV逻辑卷），划分出来的虚拟分区的容量可以按需扩展或缩小（不建议）

VG卷组的管理：
    vgcreate、vgscan、vgdisplay、vgremove、vgextend
LV逻辑卷的管理：
    lvcreate、lvscan、lvdisplay、lvremove、lvextend

扩展逻辑卷操作：
# vgextend  卷组名   空闲设备路径
# lvextend  -L  新容量大小  /dev/卷组名/逻辑卷名

刷新文件系统大小：
先检查文件系统的类型（是EXT3/EXT4，还是XFS）
# blkid  /dev/systemvg/vo
EXT3/EXT4刷新操作：
# resize2fs  /dev/systemvg/vo
XFS刷新操作：
# xfs_growfs  /dev/systemvg/vo


12. 添加交换分区
用途：以硬盘空间模拟内存使用
创建交换空间：mkswap  空闲设备

启用交换空间：
手动启用 —— swapon  交换设备
手动停用 —— swapoff  交换设备
开机自动启用 —— 
# vim  /etc/fstab
/dev/vdb7       swap    swap    defaults 0 0
# swapon  -a

补充说明：如果有优先级要求，那么挂载参数添加 pri=5


列出交换分区详细信息：
# swapon  -s






####################################################
